{
	email {$CADDY_EMAIL}
}

{$DEMO_DOMAIN} {
	encode zstd gzip

	# Optional protection for admin and debug routes:
	# 1) Generate a hash: docker run --rm caddy:2.9-alpine caddy hash-password --plaintext "CHANGE_ME"
	# 2) Set BASIC_AUTH_USER and BASIC_AUTH_PASSWORD_HASH in .env.prod
	# 3) Uncomment the block below
	#
	# @protected path /admin* /debug/*
	# basicauth @protected {
	#	{$BASIC_AUTH_USER} {$BASIC_AUTH_PASSWORD_HASH}
	# }

	@health path /healthz
	handle @health {
		reverse_proxy web:8000
	}

	handle_path /static/* {
		root * /srv/static
		file_server
	}

	header {
		-Server
		Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
		X-Content-Type-Options "nosniff"
		X-Frame-Options "DENY"
		Referrer-Policy "strict-origin-when-cross-origin"
		Permissions-Policy "camera=(), microphone=(), geolocation=()"
	}

	handle {
		reverse_proxy web:8000
	}
}
